<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Giriş – Tuzla Belediyesi Enerji SCADA</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
    margin: 0;
    font-family: Arial;
    background: #eef3f9;
}

.login-box {
    width: 330px;
    background: white;
    padding: 25px;
    border-radius: 10px;
    margin: 120px auto;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #0059a9;
}

input {
    width: 100%;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1px solid #cbd5e1;
    font-size: 14px;
}

button {
    width: 100%;
    padding: 12px;
    background: #0059a9;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background: #0a6bd3;
}

#error {
    color: red;
    text-align: center;
    margin-top: 8px;
    min-height: 20px;
    font-size: 13px;
}
</style>
</head>

<body>

<div class="login-box">
    <h2>SCADA Giriş</h2>

    <input id="username" placeholder="Kullanıcı Adı" />
    <input id="password" type="password" placeholder="Şifre" />

    <button id="login-btn" type="button">Giriş Yap</button>
    <div id="error"></div>
</div>

<script>
const API_BASE = "/api";

async function doLogin() {
    const userEl = document.getElementById("username");
    const passEl = document.getElementById("password");
    const errEl  = document.getElementById("error");

    const username = userEl.value.trim();
    const password = passEl.value.trim();

    errEl.textContent = "";

    if (!username || !password) {
        errEl.textContent = "Kullanıcı adı ve şifre girin.";
        return;
    }

    try {
        const res = await fetch(API_BASE + "/login", {
            method: "POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (!res.ok || data.error) {
            errEl.textContent = data.error || "Giriş başarısız.";
            return;
        }

        localStorage.setItem("token", data.token);
        localStorage.setItem("role", data.role);

        window.location.href = "index.html";
    } catch (e) {
        console.error(e);
        errEl.textContent = "Sunucuya bağlanılamadı.";
    }
}

document.getElementById("login-btn").addEventListener("click", doLogin);
</script>

</body>
</html>
